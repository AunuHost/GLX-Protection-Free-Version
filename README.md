
# GLX Protection

GLX Protection is an advanced Discord **security and community bot** with a built‑in web dashboard.

Main features:

- Anti‑Spam, Anti‑Raid, Anti‑Invites, Anti‑Mentions
- Deep integration with **Discord AutoMod**  
- Per‑user warning system with automatic timeouts
- Two‑Factor Web Login (Access Code + 6‑digit PIN)
- Separate **user** and **admin** web access modes
- Modern dark web dashboard with live traffic graph
- Multi‑file architecture: `glxbot/` for the bot, `glxweb/` for the dashboard

Credit is embedded everywhere as:

> GLX Protection • Created by **AunuXdev** (Creator/Developer)

---

## Project Layout

```text
GLX_Protection/
├─ bot.py
├─ requirements.txt
├─ env.example
├─ README.md
├─ glxbot/
│  ├─ __init__.py
│  ├─ config.py
│  ├─ state.py
│  ├─ security.py
│  ├─ automod_sync.py
│  ├─ discipline.py
│  ├─ events.py
│  ├─ commands_moderation.py
│  ├─ commands_protection.py
│  ├─ commands_community.py
│  ├─ commands_access.py
│  └─ core.py
└─ glxweb/
   ├─ __init__.py
   ├─ app.py
   └─ templates/
      └─ index.html
```

---

## Requirements

- Python **3.10+**
- A Discord bot application with a bot token
- `discord.py` 2.6.4

Install Python dependencies:

```bash
pip3 install -r requirements.txt
```

---

## Environment Configuration

Copy the example environment file and fill in your values:

```bash
cp env.example .env
```

Then edit `.env`:

```dotenv
DISCORD_TOKEN=YOUR_DISCORD_BOT_TOKEN

GLX_PREFIX=!
GLX_GAME_STATUS=GLX Protection • Guarding your community

GLX_WEB_HOST=0.0.0.0
GLX_WEB_PORT=8000

GLX_OWNER_ID=YOUR_DISCORD_USER_ID
```

Notes:

- `DISCORD_TOKEN` is the bot token from the Discord Developer Portal.
- `GLX_OWNER_ID` must be your numeric Discord user ID (not a mention).  
  Only this user can generate **admin web keys**.

The names of the environment variables are fixed so that your previous setup remains compatible.

---

## Starting The Bot And Dashboard

Run:

```bash
python bot.py
```

If everything is configured correctly you should see log lines similar to:

```text
[GLX] Web dashboard running at http://0.0.0.0:8000
[GLX] Logged in as ...
[GLX] Connected to guild: ...
```

No console spam is produced for AutoMod rule limits or HTTP codes. GLX only logs a single notice per guild when AutoMod capacity is reached.

Open the dashboard in your browser:

```text
http://localhost:8000/
```

---

## Two‑Factor Web Login

The dashboard uses a simple two‑factor model:

1. **Access Code** (license‑style string)
2. **PIN** (6‑digit numeric second factor)

Both are generated by GLX inside Discord.

### User Keys (Per‑Server)

In a server where the bot is installed, a server administrator runs:

```text
!generate
```

The bot responds with something like:

```text
New GLX USER web key generated.
Code: GLX-MYSERVER-ABCD
2FA PIN: 123456
Use this code and PIN on the web dashboard login page.
This key is scoped only to this server.
```

Use:

- `Code` in the **Access Code** field
- `PIN` in the **Two‑Factor PIN** field

With a user key:

- The dashboard only shows statistics and configuration for that single server.
- No global admin panel is visible.
- You can toggle protections for that server from the web.

### Admin Keys (Global)

The bot owner (user whose ID equals `GLX_OWNER_ID` in `.env`) can run:

```text
!genadmin
```

The bot responds with:

```text
New GLX ADMIN web key generated.
Code: GLX-ADMIN-ABCD
2FA PIN: 654321
Use this code and PIN on the web dashboard login page to unlock the global admin panel.
```

With an admin key:

- The dashboard shows **all servers** the bot is currently in.
- An **Admin Panel** section appears:
  - Force the bot to leave specific servers
  - Trigger a global AutoMod resync

All keys and PINs are stored only in memory. Restarting the bot clears all keys.

---

## Security Features

### Anti‑Spam

- Tracks message frequency per user in a short time window.
- If messages exceed the configured limit:
  - Messages are deleted when possible.
  - The user receives an automatic **warn**.
  - The user is **timed out** for a configured duration.
  - An entry is logged in the `glx-logs` channel.

Configuration is driven via environment variables:

- `GLX_SPAM_WINDOW_SECONDS`
- `GLX_SPAM_MAX_MESSAGES`
- `GLX_AUTOMUTE_SECONDS`

### Anti‑Raid

- Tracks member joins per guild.
- If a burst of joins is detected:
  - GLX enables a raid lockdown by removing send permission in all text channels.
  - After a configured time the lockdown is automatically lifted and logged.

Variables:

- `GLX_RAID_WINDOW_SECONDS`
- `GLX_RAID_JOIN_THRESHOLD`
- `GLX_RAID_LOCK_MINUTES`

### Anti‑Invites

- Detects common Discord invite link patterns.
- Deletes the offending message.
- Applies an automatic warn.
- Logs the event.

### Anti‑Mentions

- Counts mentions and `@everyone` in each message.
- When mention count exceeds the threshold:
  - Message is deleted.
  - Automatic warn and timeout are applied.
  - The event is logged.

Variable:

- `GLX_MENTION_THRESHOLD`

### Discord AutoMod Integration

GLX uses the HTTP client from `discord.py` to synchronize a set of AutoMod rules:

- A spam rule
- A mention‑spam rule
- A preset rule
- A configurable number of keyword rules to fully occupy AutoMod capacity

The code is defensive:

- If the guild already reached the AutoMod cap, GLX logs **only once per guild** and stops trying to create more rules.
- There is no endless error loop and no console spam.

The admin web panel includes a button that triggers a full AutoMod resync for all guilds.

---

## Community And Moderation Commands

Prefix below is shown as `!` but is configurable via `GLX_PREFIX`.

### General

- `!help` – show an overview of all commands
- `!ping` – show bot latency
- `!glx` – show GLX status card (uptime, servers, features)
- `!serverinfo` – show server information and statistics
- `!userinfo [user]` – show information and warn count for a user
- `!avatar [user]` – show user avatar

### Moderation

- `!mute @user [minutes] [reason]`
- `!unmute @user`
- `!warn @user [reason]` – warnings are counted; after a threshold the user is automatically timed out
- `!warnings [@user]` – show current warn count
- `!clearwarns @user` – reset warns for a user
- `!ban @user [reason]`
- `!kick @user [reason]`
- `!unban name#0000`
- `!clear [amount]`
- `!slowmode seconds [#channel]` – update channel slowmode
- `!say [#channel] text` – send a message as the bot

### Protection

- `!raidlock on|off` – enable or disable full raid lockdown
- `!lock [#channel]` – lock a single channel
- `!unlock [#channel]` – unlock a single channel
- `!glxstats` – view per‑guild security statistics
- `!togglespam` – toggle Anti‑Spam
- `!toggleinvites` – toggle Anti‑Invites
- `!togglementions` – toggle Anti‑Mentions
- `!togglenuke` – enable or disable the destructive nuke command
- `!nuke [#channel]` – clone and reset a channel (only when nuke is enabled)

### Community

- `!setsuggest #channel` – choose where suggestions are sent
- `!suggest your idea` – send a suggestion embed to the suggestion channel
- `!poll question | Option 1 | Option 2` – create a reaction‑based poll
- `!setwelcome #channel` – choose where welcome messages are posted
- `!setwelcomemsg text` – configure the welcome template (`{member}` and `{server}` placeholders)
- `!remindme 10m take a break` – personal reminder, delivered by DM or reply

### Whitelist And Web Access

- `!glxwhitelist @member` – allow a user to bypass GLX protections
- `!glxunwhitelist @member` – remove a user from the whitelist
- `!generate [pattern]` – generate a user web key (server‑scoped)
- `!genadmin [pattern]` – generate an admin web key (bot owner only)

Patterns for `!generate` and `!genadmin` are optional and allow customizing the code prefix.

---

## Web Dashboard

The dashboard at `/` includes:

- Overview cards: servers, message count, security actions
- Live feature toggles (Anti‑Spam, Anti‑Raid, AutoMod, Anti‑Invites, Anti‑Mentions, Nuke)
- A live traffic chart (last 5 minutes) based on message events
- A server list with member and bot counts
- A license panel showing how many keys are active

With an admin key the **Admin Panel** section is revealed:

- A Force Leave button per guild
- A button to trigger AutoMod sync across all guilds

---

## Hosting Notes

On a VPS or dedicated server:

1. Upload the entire project folder.
2. Configure `.env`.
3. Install dependencies with `pip install -r requirements.txt`.
4. Start the bot with `python bot.py`.
5. Reverse‑proxy or tunnel `http://0.0.0.0:8000` as needed using Cloudflare Tunnel, Nginx, or other tools.

The bot and web dashboard run in a single Python process. The web app binds to `GLX_WEB_HOST:GLX_WEB_PORT` and is safe to expose behind a tunnel because all sensitive operations still require a valid Access Code and PIN generated inside Discord.

---
